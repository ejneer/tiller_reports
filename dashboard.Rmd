---
title: "Neer Financial Dashboard"
output: flexdashboard::flex_dashboard
---

```{r, include=FALSE}
library(tidyverse)
library(googlesheets4)
library(lubridate)
library(ggplot2)
library(plotly)
```

```{r include=FALSE}
options(
  gargle_oauth_cache = ".secrets",
  gargle_oauth_email = TRUE
)

sheet_id <- "19XVxijLjfoICUzaFb_R-4vlWuCdeagcMWye2E2Gp4AM"
theme = theme_minimal()
```

```{r}
transactions <- read_sheet(sheet_id, sheet = "Transactions") %>% 
  mutate(
    Week = as.Date(Week),
    Month = month(Month, label = TRUE, abbr = FALSE)
  )

categories <- read_sheet(sheet_id, sheet = "Categories") %>% 
  rename(Hide = `Hide From Reports`) %>% 
  select(Category:Hide)

balances <- read_sheet(sheet_id, sheet = "Balance History")

reportable_transactions <- transactions %>% 
  inner_join(categories) %>% 
  filter(is.na(Hide))

weekly_cash_flow <- reportable_transactions %>%
  group_by(Week, Group) %>%
  summarize(Amount = sum(Amount)) %>%
  pivot_wider(id_cols = Week,
              names_from = Group,
              values_from = Amount) %>%
  mutate_at(vars(-group_cols()), function(x) replace_na(x, 0)) %>%
  ungroup() %>%
  mutate(
    Spending = Bills + Discretionary,
    Net = Income + Spending,
    Cumulative = cumsum(Net),
  )

# define how many weeks to include in weekly spending charts
breaks = weekly_cash_flow %>% select(Week) %>% tail(8)
```

# Overview

```{r child = "overview.Rmd"}

```


# Monthly Overview

